<!DOCTYPE html>
<html lang="fr">
<head>
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>

  <!-- Apparaître progressivement après 2 sec -->
  <script>
    AFRAME.registerComponent('appear-from-flat', {
      schema: {
        delay: {default: 2000},      // Attente avant l’apparition
        duration: {default: 1200}    // Durée de la sortie 3D
      },

      init: function () {
        const el = this.el;

        // On stocke la position et l’échelle finales
        const finalPos = el.object3D.position.clone();
        const finalScale = el.object3D.scale.clone();

        // On place l’objet "à plat"
        el.object3D.scale.set(finalScale.x, finalScale.y, 0.001);
        el.setAttribute("material", "opacity: 0; transparent: true;");

        // On avance la vidéo vers la caméra (comme écrasée contre l'affiche)
        el.object3D.position.z = finalPos.z + 0.5;

        // Lancement après délai
        setTimeout(() => {
          // Fade-in
          el.setAttribute("animation__fade", {
            property: "material.opacity",
            from: 0,
            to: 1,
            dur: this.data.duration,
            easing: "easeOutQuad"
          });

          // Dépliage 3D
          el.setAttribute("animation__scale", {
            property: "scale",
            from: `${finalScale.x} ${finalScale.y} 0.001`,
            to: `${finalScale.x} ${finalScale.y} ${finalScale.z}`,
            dur: this.data.duration,
            easing: "easeOutQuad"
          });

          // Recul vers sa vraie position
          el.setAttribute("animation__move", {
            property: "position",
            from: `${finalPos.x} ${finalPos.y} ${finalPos.z + 0.5}`,
            to: `${finalPos.x} ${finalPos.y} ${finalPos.z}`,
            dur: this.data.duration,
            easing: "easeOutQuad"
          });

        }, this.data.delay);
      }
    });
  </script>

</head>

<body>

  <a-scene>

    <!-- ASSETS VIDÉOS -->
    <a-assets>
      <video id="video1" src="assets/films/Temoin1extra.mp4" playsinline autoplay muted></video>
      <video id="video2" src="assets/films/Temoin2extra.mp4" playsinline autoplay muted></video>
      <video id="video3" src="assets/films/Temoin3extra.mp4" playsinline autoplay muted></video>
    </a-assets>

    <!-- CAMÉRA + CURSEUR -->
    <a-entity camera look-controls position="0 1.6 0">
      <a-entity id="cursor"
        cursor="fuse:true; fuseTimeout:800"
        raycaster="objects: .playable"
        position="0 0 -1"
        geometry="primitive:ring; radiusInner:0.02; radiusOuter:0.03"
        material="color:#ff2222; shader:flat">
      </a-entity>
    </a-entity>

    <!-- VIDÉO 1 -->
    <a-video class="playable"
             src="#video1"
             width="16" height="9"
             position="0 1.5 -3"
             scale="0.2 0.2 0.2"
             appear-from-flat>
    </a-video>

    <!-- VIDÉO 2 -->
    <a-video class="playable"
             src="#video2"
             width="16" height="9"
             position="1 1.45 -3.1"
             rotation="0 -20 0"
             scale="0.2 0.2 0.2"
             appear-from-flat>
    </a-video>

    <!-- VIDÉO 3 -->
    <a-video class="playable"
             src="#video3"
             width="16" height="9"
             position="-1 1.45 -3.1"
             rotation="0 20 0"
             scale="0.2 0.2 0.2"
             appear-from-flat>
    </a-video>

  </a-scene>

</body>
</html>
